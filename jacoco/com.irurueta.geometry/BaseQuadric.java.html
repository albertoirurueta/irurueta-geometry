<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BaseQuadric.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-geometry</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.geometry</a> &gt; <span class="el_source">BaseQuadric.java</span></div><h1>BaseQuadric.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2012 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.geometry;

import com.irurueta.algebra.Matrix;
import com.irurueta.algebra.Utils;
import com.irurueta.algebra.WrongSizeException;

import java.io.Serializable;

/**
 * Class defining the base interface of any possible quadric.
 * Appropriate subclasses should be used for each quadric type: pure quadrics
 * and dual quadrics.
 */
public abstract class BaseQuadric implements Serializable {
    /**
     * Number of rows of one matrix that contains quadric parameters.
     */
    public static final int BASEQUADRIC_MATRIX_ROW_SIZE = 4;

    /**
     * Number of columns of one matrix that contains quadric parameters.
     */
    public static final int BASEQUADRIC_MATRIX_COLUMN_SIZE = 4;

    /**
     * Number of parameters on a quadric or dual quadric.
     */
    public static final int N_PARAMS = 10;

    /**
     * Threshold above zero to determine whether a point lies inside (is locus
     * of) the given quadric or not.
     */
    public static final double DEFAULT_LOCUS_THRESHOLD = 1e-12;

    /**
     * Threshold above zero to determine whether two points of a quadric are
     * perpendicular or not.
     */
    public static final double DEFAULT_PERPENDICULAR_THRESHOLD = 1e-12;

    /**
     * Minimum allowed threshold.
     */
    public static final double MIN_THRESHOLD = 0.0;

    /**
     * Threshold above zero to determine whether one matrix is symmetric or not.
     */
    private static final double DEFAULT_SYMMETRIC_THRESHOLD = 1e-12;

    /**
     * Machine precision.
     */
    private static final double PRECISION = 1e-12;

    /**
     * A element of the matrix defining a quadric.
     */
    private double a;

    /**
     * B element of the matrix defining a quadric.
     */
    private double b;

    /**
     * C element of the matrix defining a quadric.
     */
    private double c;

    /**
     * D element of the matrix defining a quadric.
     */
    private double d;

    /**
     * E element of the matrix defining a quadric.
     */
    private double e;

    /**
     * F element of the matrix defining a quadric.
     */
    private double f;

    /**
     * G element of the matrix defining a quadric.
     */
    private double g;

    /**
     * H element of the matrix defining a quadric.
     */
    private double h;

    /**
     * I element of the matrix defining a quadric.
     */
    private double i;

    /**
     * J element of the matrix defining a quadric.
     */
    private double j;

    /**
     * Determines whether this instance is already normalized.
     */
    private boolean normalized;

    /**
     * Constructor of this class.
     */
<span class="fc" id="L130">    protected BaseQuadric() {</span>
<span class="fc" id="L131">        a = b = c = d = e = f = g = h = i = j = 0.0;</span>
<span class="fc" id="L132">        normalized = false;</span>
<span class="fc" id="L133">    }</span>

    /**
     * Constructor of this class. This constructor accepts every parameter
     * describing a base quadric (parameters a, b, c, d, e, f, g, h, i).
     *
     * @param a Parameter A of the base quadric.
     * @param b Parameter B of the base quadric.
     * @param c Parameter C of the base quadric.
     * @param d Parameter D of the base quadric.
     * @param e Parameter E of the base quadric.
     * @param f Parameter F of the base quadric.
     * @param g Parameter G of the base quadric.
     * @param h Parameter H of the base quadric.
     * @param i Parameter I of the base quadric.
     * @param j Parameter J of the base quadric.
     */
    protected BaseQuadric(final double a, final double b, final double c, final double d, final double e,
<span class="fc" id="L151">                          final double f, final double g, final double h, final double i, final double j) {</span>
<span class="fc" id="L152">        setParameters(a, b, c, d, e, f, g, h, i, j);</span>
<span class="fc" id="L153">    }</span>

    /**
     * Constructor. This constructor accepts a Matrix describing a base quadric.
     *
     * @param m 4x4 matrix describing a base quadric.
     * @throws NonSymmetricMatrixException Raised when the quadric matrix is not
     *                                     symmetric.
     * @throws IllegalArgumentException    Raised when the size of the matrix is
     *                                     not 4x4.
     */
<span class="fc" id="L164">    protected BaseQuadric(final Matrix m) throws NonSymmetricMatrixException {</span>
<span class="fc" id="L165">        setParameters(m);</span>
<span class="fc" id="L166">    }</span>

    /**
     * Returns parameter A of the given base quadric.
     *
     * @return Parameter B of a matrix describing a base quadric.
     */
    public double getA() {
<span class="fc" id="L174">        return a;</span>
    }

    /**
     * Returns parameter B of the given base quadric.
     *
     * @return Parameter B of a matrix describing a base quadric.
     */
    public double getB() {
<span class="fc" id="L183">        return b;</span>
    }

    /**
     * Returns parameter C of the given base quadric.
     *
     * @return Parameter C of a matrix describing a base quadric.
     */
    public double getC() {
<span class="fc" id="L192">        return c;</span>
    }

    /**
     * Returns parameter D of the given base quadric.
     *
     * @return Parameter D of a matrix describing a base quadric.
     */
    public double getD() {
<span class="fc" id="L201">        return d;</span>
    }

    /**
     * Returns parameter E of the given base quadric.
     *
     * @return Parameter E of a matrix describing a base quadric.
     */
    public double getE() {
<span class="fc" id="L210">        return e;</span>
    }

    /**
     * Returns parameter F of the given base quadric.
     *
     * @return Parameter F of a matrix describing a base quadric.
     */
    public double getF() {
<span class="fc" id="L219">        return f;</span>
    }

    /**
     * Returns parameter G of the given base quadric.
     *
     * @return Parameter G of a matrix describing a base quadric.
     */
    public double getG() {
<span class="fc" id="L228">        return g;</span>
    }

    /**
     * Returns parameter H of the given base quadric.
     *
     * @return Parameter H of a matrix describing a base quadric.
     */
    public double getH() {
<span class="fc" id="L237">        return h;</span>
    }

    /**
     * Returns parameter I of the given base quadric.
     *
     * @return Parameter I of a matrix describing a base quadric.
     */
    public double getI() {
<span class="fc" id="L246">        return i;</span>
    }

    /**
     * Returns parameter J of the given base quadric.
     *
     * @return Parameter J of a matrix describing a base quadric.
     */
    public double getJ() {
<span class="fc" id="L255">        return j;</span>
    }

    /**
     * This method accepts every parameter describing a base quadric (parameters
     * a, b, c, d, e, f, g, h, i,, j).
     *
     * @param a Parameter A of the base quadric.
     * @param b Parameter B of the base quadric.
     * @param c Parameter C of the base quadric.
     * @param d Parameter D of the base quadric.
     * @param e Parameter E of the base quadric.
     * @param f Parameter F of the base quadric.
     * @param g Parameter G of the base quadric.
     * @param h Parameter H of the base quadric.
     * @param i Parameter I of the base quadric.
     * @param j Parameter J of the base quadric.
     */
    public final void setParameters(final double a, final double b, final double c, final double d, final double e,
                                    final double f, final double g, final double h, final double i, final double j) {
<span class="fc" id="L275">        this.a = a;</span>
<span class="fc" id="L276">        this.b = b;</span>
<span class="fc" id="L277">        this.c = c;</span>
<span class="fc" id="L278">        this.d = d;</span>
<span class="fc" id="L279">        this.e = e;</span>
<span class="fc" id="L280">        this.f = f;</span>
<span class="fc" id="L281">        this.g = g;</span>
<span class="fc" id="L282">        this.h = h;</span>
<span class="fc" id="L283">        this.i = i;</span>
<span class="fc" id="L284">        this.j = j;</span>
<span class="fc" id="L285">        normalized = false;</span>
<span class="fc" id="L286">    }</span>

    /**
     * This method sets the matrix used for describing a base quadric.
     * This matrix must be 4x4 and symmetric.
     *
     * @param m                  4x4 Matrix describing a base quadric.
     * @param symmetricThreshold Grade of tolerance to determine whether a
     *                           matrix is symmetric or not. It is used because due to machine precision
     *                           a matrix might not be considered exactly symmetric (by default:
     *                           DEFAULT_SYMMETRIC_THRESHOLD is used).
     * @throws IllegalArgumentException    Raised when the size of the matrix is
     *                                     not 4x4.
     * @throws NonSymmetricMatrixException Raised when the quadric matrix is not
     *                                     symmetric.
     */
    public final void setParameters(final Matrix m, final double symmetricThreshold)
            throws NonSymmetricMatrixException {
<span class="fc bfc" id="L304" title="All 4 branches covered.">        if (m.getRows() != BASEQUADRIC_MATRIX_ROW_SIZE || m.getColumns() != BASEQUADRIC_MATRIX_COLUMN_SIZE) {</span>
<span class="fc" id="L305">            throw new IllegalArgumentException();</span>
        } else {
<span class="fc bfc" id="L307" title="All 2 branches covered.">            if (!Utils.isSymmetric(m, symmetricThreshold)) {</span>
<span class="fc" id="L308">                throw new NonSymmetricMatrixException();</span>
            } else {
<span class="fc" id="L310">                a = m.getElementAt(0, 0);</span>
<span class="fc" id="L311">                b = m.getElementAt(1, 1);</span>
<span class="fc" id="L312">                c = m.getElementAt(2, 2);</span>
<span class="fc" id="L313">                d = m.getElementAt(0, 1);</span>
<span class="fc" id="L314">                e = m.getElementAt(2, 1);</span>
<span class="fc" id="L315">                f = m.getElementAt(2, 0);</span>
<span class="fc" id="L316">                g = m.getElementAt(3, 0);</span>
<span class="fc" id="L317">                h = m.getElementAt(3, 1);</span>
<span class="fc" id="L318">                i = m.getElementAt(3, 2);</span>
<span class="fc" id="L319">                j = m.getElementAt(3, 3);</span>
<span class="fc" id="L320">                normalized = false;</span>
            }
        }
<span class="fc" id="L323">    }</span>

    /**
     * This method sets the matrix used for describing a base quadric.
     * This matrix must be 4x4 and symmetric.
     *
     * @param m 4x4 matrix describing a base quadric.
     * @throws IllegalArgumentException    Raised when the size of the matrix is
     *                                     not 4x4.
     * @throws NonSymmetricMatrixException Raised when the quadric matrix is not
     *                                     symmetric.
     */
    public final void setParameters(final Matrix m) throws NonSymmetricMatrixException {
<span class="fc" id="L336">        setParameters(m, DEFAULT_SYMMETRIC_THRESHOLD);</span>
<span class="fc" id="L337">    }</span>

    /**
     * This method sets the A parameter of a base quadric.
     *
     * @param a Parameter A of the given base quadric.
     */
    public void setA(final double a) {
<span class="fc" id="L345">        this.a = a;</span>
<span class="fc" id="L346">        normalized = false;</span>
<span class="fc" id="L347">    }</span>

    /**
     * This method sets the B parameter of a base quadric.
     *
     * @param b Parameter B of the given base quadric.
     */
    public void setB(final double b) {
<span class="fc" id="L355">        this.b = b;</span>
<span class="fc" id="L356">        normalized = false;</span>
<span class="fc" id="L357">    }</span>

    /**
     * This method sets the C parameter of a base quadric.
     *
     * @param c Parameter C of the given base quadric.
     */
    public void setC(final double c) {
<span class="fc" id="L365">        this.c = c;</span>
<span class="fc" id="L366">        normalized = false;</span>
<span class="fc" id="L367">    }</span>

    /**
     * This method sets the D parameter of a base quadric.
     *
     * @param d Parameter D of the given base quadric.
     */
    public void setD(final double d) {
<span class="fc" id="L375">        this.d = d;</span>
<span class="fc" id="L376">        normalized = false;</span>
<span class="fc" id="L377">    }</span>

    /**
     * This method sets the E parameter of a base quadric.
     *
     * @param e Parameter E of the given base quadric.
     */
    public void setE(final double e) {
<span class="fc" id="L385">        this.e = e;</span>
<span class="fc" id="L386">        normalized = false;</span>
<span class="fc" id="L387">    }</span>

    /**
     * This method sets the F parameter of a base quadric.
     *
     * @param f Parameter F of the given base quadric.
     */
    public void setF(final double f) {
<span class="fc" id="L395">        this.f = f;</span>
<span class="fc" id="L396">        normalized = false;</span>
<span class="fc" id="L397">    }</span>

    /**
     * This method sets the G parameter of a base quadric.
     *
     * @param g Parameter G of the given base quadric.
     */
    public void setG(final double g) {
<span class="fc" id="L405">        this.g = g;</span>
<span class="fc" id="L406">        normalized = false;</span>
<span class="fc" id="L407">    }</span>

    /**
     * This method sets the H parameter of a base quadric.
     *
     * @param h Parameter H of the given base quadric.
     */
    public void setH(final double h) {
<span class="fc" id="L415">        this.h = h;</span>
<span class="fc" id="L416">        normalized = false;</span>
<span class="fc" id="L417">    }</span>

    /**
     * This method sets the &quot;I&quot; parameter of a base quadric.
     *
     * @param i Parameter &quot;I&quot; of the given base quadric.
     */
    public void setI(final double i) {
<span class="fc" id="L425">        this.i = i;</span>
<span class="fc" id="L426">        normalized = false;</span>
<span class="fc" id="L427">    }</span>

    /**
     * This method sets the J parameter of a base quadric.
     *
     * @param j Parameter J of the given base quadric.
     */
    public void setJ(final double j) {
<span class="fc" id="L435">        this.j = j;</span>
<span class="fc" id="L436">        normalized = false;</span>
<span class="fc" id="L437">    }</span>

    /**
     * Returns the matrix that describes this base quadric.
     *
     * @return 4x4 matrix describing this base quadric.
     */
    public Matrix asMatrix() {
<span class="fc" id="L445">        Matrix out = null;</span>
        try {
<span class="fc" id="L447">            out = new Matrix(BASEQUADRIC_MATRIX_ROW_SIZE,</span>
                    BASEQUADRIC_MATRIX_COLUMN_SIZE);
<span class="fc" id="L449">            asMatrix(out);</span>
<span class="nc" id="L450">        } catch (final WrongSizeException ignore) {</span>
            // never happens
<span class="fc" id="L452">        }</span>
<span class="fc" id="L453">        return out;</span>
    }

    /**
     * Sets the values in provided matrix corresponding to this base quadric.
     *
     * @param m Provided matrix where values will be stored.
     * @throws IllegalArgumentException Raised if provided matrix is not 4x4.
     */
    public void asMatrix(final Matrix m) {
<span class="pc bpc" id="L463" title="2 of 4 branches missed.">        if (m.getRows() != BASEQUADRIC_MATRIX_ROW_SIZE || m.getColumns() != BASEQUADRIC_MATRIX_ROW_SIZE) {</span>
<span class="nc" id="L464">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L467">        m.setElementAt(0, 0, a);</span>
<span class="fc" id="L468">        m.setElementAt(1, 1, b);</span>
<span class="fc" id="L469">        m.setElementAt(2, 2, c);</span>
<span class="fc" id="L470">        m.setElementAt(3, 3, j);</span>
<span class="fc" id="L471">        m.setElementAt(1, 0, d);</span>
<span class="fc" id="L472">        m.setElementAt(0, 1, d);</span>
<span class="fc" id="L473">        m.setElementAt(2, 1, e);</span>
<span class="fc" id="L474">        m.setElementAt(1, 2, e);</span>
<span class="fc" id="L475">        m.setElementAt(2, 0, f);</span>
<span class="fc" id="L476">        m.setElementAt(0, 2, f);</span>
<span class="fc" id="L477">        m.setElementAt(3, 0, g);</span>
<span class="fc" id="L478">        m.setElementAt(0, 3, g);</span>
<span class="fc" id="L479">        m.setElementAt(3, 1, h);</span>
<span class="fc" id="L480">        m.setElementAt(1, 3, h);</span>
<span class="fc" id="L481">        m.setElementAt(3, 2, i);</span>
<span class="fc" id="L482">        m.setElementAt(2, 3, i);</span>
<span class="fc" id="L483">    }</span>

    /**
     * Normalizes the Quadric params using its norm.
     */
    public void normalize() {
<span class="fc bfc" id="L489" title="All 2 branches covered.">        if (!normalized) {</span>
<span class="fc" id="L490">            final var m = asMatrix();</span>
<span class="fc" id="L491">            final var norm = Utils.normF(m);</span>

<span class="fc bfc" id="L493" title="All 2 branches covered.">            if (norm &gt; PRECISION) {</span>
<span class="fc" id="L494">                a /= norm;</span>
<span class="fc" id="L495">                b /= norm;</span>
<span class="fc" id="L496">                c /= norm;</span>
<span class="fc" id="L497">                d /= norm;</span>
<span class="fc" id="L498">                e /= norm;</span>
<span class="fc" id="L499">                f /= norm;</span>
<span class="fc" id="L500">                g /= norm;</span>
<span class="fc" id="L501">                h /= norm;</span>
<span class="fc" id="L502">                i /= norm;</span>
<span class="fc" id="L503">                j /= norm;</span>
<span class="fc" id="L504">                normalized = true;</span>
            }
        }
<span class="fc" id="L507">    }</span>

    /**
     * Returns boolean indicating whether this base quadric has already been
     * normalized.
     *
     * @return True if normalized, false otherwise.
     */
    public boolean isNormalized() {
<span class="fc" id="L516">        return normalized;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>